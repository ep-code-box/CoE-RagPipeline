# 🔧 CoE RAG Pipeline 문제 해결 가이드

## 404 에러: "분석 결과를 찾을 수 없습니다"

### 문제 설명
`/results/{analysis_id}` 엔드포인트에서 404 에러가 발생하는 경우

### 가능한 원인들

1. **잘못된 analysis_id 사용**
   - 분석 시작 시 반환된 analysis_id와 다른 값을 사용
   - 오타나 복사/붙여넣기 오류

2. **분석이 아직 진행 중**
   - 분석이 완료되기 전에 결과를 조회하려고 시도
   - 대용량 레포지토리의 경우 분석에 시간이 오래 걸릴 수 있음

3. **분석 실패**
   - 네트워크 오류, Git 클론 실패, 권한 문제 등으로 분석이 실패
   - 분석 중 예외 발생

4. **서버 재시작 (이전 버전)**
   - 메모리 기반 저장소를 사용하던 이전 버전에서는 서버 재시작 시 결과 손실
   - **현재 버전에서는 해결됨**: 영구 저장소 사용

### 해결 방법

#### 1. 분석 상태 확인
```bash
# 모든 분석 결과 목록 조회
curl -X GET "http://127.0.0.1:8001/results"
```

#### 2. 올바른 analysis_id 확인
분석 시작 시 반환된 응답에서 정확한 analysis_id를 확인:
```json
{
  "analysis_id": "88722fc6-d435-4261-8c37-37a857429221",
  "status": "started",
  "message": "분석이 시작되었습니다. /results/{analysis_id} 엔드포인트로 결과를 확인하세요."
}
```

#### 3. 분석 완료 대기
분석 상태가 "completed"가 될 때까지 기다린 후 결과 조회:
```bash
# 주기적으로 상태 확인
curl -X GET "http://127.0.0.1:8001/results/{analysis_id}"
```

#### 4. 개선된 에러 메시지 활용
404 에러 발생 시 상세한 정보가 제공됩니다:
```json
{
  "detail": {
    "message": "분석 결과를 찾을 수 없습니다.",
    "analysis_id": "nonexistent-id",
    "available_analysis_ids": ["88722fc6-d435-4261-8c37-37a857429221"],
    "total_available": 1,
    "suggestions": [
      "1. 올바른 analysis_id를 사용하고 있는지 확인하세요.",
      "2. /results 엔드포인트로 사용 가능한 분석 결과 목록을 확인하세요.",
      "3. 분석이 아직 진행 중이거나 실패했을 수 있습니다.",
      "4. 분석 ID 형식이 올바른지 확인하세요 (UUID 형식)."
    ]
  }
}
```

## 기타 문제들

### 분석이 시작되지 않음
- 서버가 실행 중인지 확인: `curl -X GET "http://127.0.0.1:8001/health"`
- 요청 JSON 형식이 올바른지 확인
- 네트워크 연결 상태 확인

### 분석이 너무 오래 걸림
- 대용량 레포지토리의 경우 정상적인 현상
- 서버 로그 확인: `tail -f server.log`
- 필요시 분석 옵션 조정 (AST, 기술스펙 분석 비활성화)

### 서버 재시작 후 결과 손실
- **현재 버전에서는 해결됨**: 모든 분석 결과가 `output/results/` 디렉토리에 JSON 파일로 저장
- 서버 시작 시 자동으로 기존 결과 로드
- 로그에서 "Loaded X analysis results from disk" 메시지 확인

## 로그 확인 방법

### 서버 로그
```bash
# 실시간 로그 확인
tail -f server.log

# 전체 로그 확인
cat server.log
```

### 분석 결과 파일 확인
```bash
# 저장된 분석 결과 파일 목록
ls -la output/results/

# 특정 분석 결과 내용 확인
cat output/results/{analysis_id}.json
```

## 개선 사항 (v1.1.0)

1. **영구 저장소**: 분석 결과가 JSON 파일로 저장되어 서버 재시작 후에도 유지
2. **개선된 에러 메시지**: 404 에러 시 상세한 정보와 해결 방법 제공
3. **자동 복구**: 메모리에 없는 결과도 디스크에서 자동 로드
4. **실패 결과 저장**: 분석 실패 시에도 결과가 저장되어 문제 분석 가능

## 지원

문제가 지속되는 경우:
1. 서버 로그 확인
2. 분석 결과 파일 확인
3. API 테스트 스크립트 실행: `python test_api.py`
4. 이슈 리포트 시 로그와 함께 제출